{"version":3,"sources":["../../../src/flows/flow.js"],"names":[],"mappings":"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","file":"flow.js","sourcesContent":["/*eslint no-cond-assign: 0*/\n\nfunction removeListener(element, event, fn) {\n  element.removeEventListener(event, fn, false);\n}\n\nfunction addListener(element, event, fn) {\n  element.addEventListener(event, fn, false);\n  return removeListener.bind(null, element, event, fn);\n}\n\nexport class Flow {\n  constructor(element, Point, events, stopEmulatedMouseEvents) {\n    this.element = element;\n    this.Point = Point;\n    this.events = events;\n    this.stopEmulatedMouseEvents = stopEmulatedMouseEvents;\n    this.addListeners = [];\n    this.removeListeners = [];\n    this.allPointers = {};\n    this.currentPointers = {};\n    this.init();\n  }\n  init() {\n    var event,\n      key,\n      types,\n      type,\n      fn;\n\n    while (event = this.events.shift()) {\n      key = Object.keys(event).shift();\n      types = event[key];\n      fn = this[key].bind(this);\n\n      if (key === \"start\") {\n        this.startListener = addListener.bind(null, this.element, types.shift(), fn);\n      } else {\n        while (type = types.shift()) {\n          this.addListeners.push(addListener.bind(null, this.element, type, fn));\n        }\n      }\n    }\n  }\n  normalizePoints(/*event, data, Point*/) {\n    throw new Error(\"normalizePoints: must be implemented in sub class\");\n  }\n  onStart(startCallback) {\n    this.startCallback = startCallback;\n    return this;\n  }\n  onUpdate(updateCallback) {\n    this.updateCallback = updateCallback;\n    return this;\n  }\n  onCancel(cancelCallback) {\n    this.cancelCallback = cancelCallback;\n    return this;\n  }\n  onEnd(endCallback) {\n    this.endCallback = endCallback;\n    return this;\n  }\n  onStop(stopCallback) {\n    this.stopCallback = stopCallback;\n  }\n  activate() {\n    return this.startListener();\n  }\n  start(event) {\n    this.normalizePoints(event, this.Point);\n    if (this.startCallback(this, event, this.allPointers, this.currentPointers)) {\n      this.continue();\n    }\n  }\n  continue() {\n    var i,\n      cnt = this.addListeners.length;\n\n    for (i = 0; i < cnt; ++i) {\n      this.removeListeners.push(this.addListeners[i]());\n    }\n  }\n  update(event) {\n    this.normalizePoints(event, this.Point);\n    this.updateCallback(this, event, this.allPointers, this.currentPointers);\n  }\n  end(event) {\n    this.normalizePoints(event, this.Point);\n    this.endCallback(this, event, this.allPointers, this.currentPointers);\n    if (Object.keys(this.allPointers).length === 0) {\n      this.stop();\n    }\n  }\n  cancel(event) {\n    this.cancelCallback(this, event, this.allPointers, this.currentPointers);\n    this.stop();\n  }\n  stop() {\n    var i,\n      cnt = this.removeListeners.length;\n\n    for (i = 0; i < cnt; ++i) {\n      this.removeListeners[i]();\n    }\n    this.removeListeners.length = 0;\n    this.stopCallback(this);\n  }\n}\n"]}