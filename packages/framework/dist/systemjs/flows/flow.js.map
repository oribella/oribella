{"version":3,"sources":["../../../src/flows/flow.js"],"names":[],"mappings":";;;;;;;;;;;;;AAEA,WAAS,cAAT,CAAwB,OAAxB,EAAiC,KAAjC,EAAwC,EAAxC,EAA4C;AAC1C,YAAQ,mBAAR,CAA4B,KAA5B,EAAmC,EAAnC,EAAuC,KAAvC,EAD0C;GAA5C;;AAIA,WAAS,WAAT,CAAqB,OAArB,EAA8B,KAA9B,EAAqC,EAArC,EAAyC;AACvC,YAAQ,gBAAR,CAAyB,KAAzB,EAAgC,EAAhC,EAAoC,KAApC,EADuC;AAEvC,WAAO,eAAe,IAAf,CAAoB,IAApB,EAA0B,OAA1B,EAAmC,KAAnC,EAA0C,EAA1C,CAAP,CAFuC;GAAzC;;;;;sBAKa;AACX,iBADW,IACX,CAAY,OAAZ,EAAqB,KAArB,EAA4B,MAA5B,EAAoC,uBAApC,EAA6D;gCADlD,MACkD;;AAC3D,eAAK,OAAL,GAAe,OAAf,CAD2D;AAE3D,eAAK,KAAL,GAAa,KAAb,CAF2D;AAG3D,eAAK,MAAL,GAAc,MAAd,CAH2D;AAI3D,eAAK,uBAAL,GAA+B,uBAA/B,CAJ2D;AAK3D,eAAK,YAAL,GAAoB,EAApB,CAL2D;AAM3D,eAAK,eAAL,GAAuB,EAAvB,CAN2D;AAO3D,eAAK,WAAL,GAAmB,EAAnB,CAP2D;AAQ3D,eAAK,eAAL,GAAuB,EAAvB,CAR2D;AAS3D,eAAK,IAAL,GAT2D;SAA7D;;AADW,uBAYX,uBAAO;AACL,cAAI,KAAJ,EACE,GADF,EAEE,KAFF,EAGE,IAHF,EAIE,EAJF,CADK;;AAOL,iBAAO,QAAQ,KAAK,MAAL,CAAY,KAAZ,EAAR,EAA6B;AAClC,kBAAM,OAAO,IAAP,CAAY,KAAZ,EAAmB,KAAnB,EAAN,CADkC;AAElC,oBAAQ,MAAM,GAAN,CAAR,CAFkC;AAGlC,iBAAK,KAAK,GAAL,EAAU,IAAV,CAAe,IAAf,CAAL,CAHkC;;AAKlC,gBAAI,QAAQ,OAAR,EAAiB;AACnB,mBAAK,aAAL,GAAqB,YAAY,IAAZ,CAAiB,IAAjB,EAAuB,KAAK,OAAL,EAAc,MAAM,KAAN,EAArC,EAAoD,EAApD,CAArB,CADmB;aAArB,MAEO;AACL,qBAAO,OAAO,MAAM,KAAN,EAAP,EAAsB;AAC3B,qBAAK,YAAL,CAAkB,IAAlB,CAAuB,YAAY,IAAZ,CAAiB,IAAjB,EAAuB,KAAK,OAAL,EAAc,IAArC,EAA2C,EAA3C,CAAvB,EAD2B;eAA7B;aAHF;WALF;;;AAnBS,uBAiCX,mEAAwC;AACtC,gBAAM,IAAI,KAAJ,CAAU,mDAAV,CAAN,CADsC;;;AAjC7B,uBAoCX,2BAAQ,eAAe;AACrB,eAAK,aAAL,GAAqB,aAArB,CADqB;AAErB,iBAAO,IAAP,CAFqB;;;AApCZ,uBAwCX,6BAAS,gBAAgB;AACvB,eAAK,cAAL,GAAsB,cAAtB,CADuB;AAEvB,iBAAO,IAAP,CAFuB;;;AAxCd,uBA4CX,6BAAS,gBAAgB;AACvB,eAAK,cAAL,GAAsB,cAAtB,CADuB;AAEvB,iBAAO,IAAP,CAFuB;;;AA5Cd,uBAgDX,uBAAM,aAAa;AACjB,eAAK,WAAL,GAAmB,WAAnB,CADiB;AAEjB,iBAAO,IAAP,CAFiB;;;AAhDR,uBAoDX,yBAAO,cAAc;AACnB,eAAK,YAAL,GAAoB,YAApB,CADmB;;;AApDV,uBAuDX,+BAAW;AACT,iBAAO,KAAK,aAAL,EAAP,CADS;;;AAvDA,uBA0DX,uBAAM,OAAO;AACX,eAAK,eAAL,CAAqB,KAArB,EAA4B,KAAK,KAAL,CAA5B,CADW;AAEX,cAAI,KAAK,aAAL,CAAmB,IAAnB,EAAyB,KAAzB,EAAgC,KAAK,WAAL,EAAkB,KAAK,eAAL,CAAtD,EAA6E;AAC3E,iBAAK,QAAL,GAD2E;WAA7E;;;AA5DS,uBAgEX,gCAAW;AACT,cAAI,CAAJ;cACE,MAAM,KAAK,YAAL,CAAkB,MAAlB,CAFC;;AAIT,eAAK,IAAI,CAAJ,EAAO,IAAI,GAAJ,EAAS,EAAE,CAAF,EAAK;AACxB,iBAAK,eAAL,CAAqB,IAArB,CAA0B,KAAK,YAAL,CAAkB,CAAlB,GAA1B,EADwB;WAA1B;;;AApES,uBAwEX,yBAAO,OAAO;AACZ,eAAK,eAAL,CAAqB,KAArB,EAA4B,KAAK,KAAL,CAA5B,CADY;AAEZ,eAAK,cAAL,CAAoB,IAApB,EAA0B,KAA1B,EAAiC,KAAK,WAAL,EAAkB,KAAK,eAAL,CAAnD,CAFY;;;AAxEH,uBA4EX,mBAAI,OAAO;AACT,eAAK,eAAL,CAAqB,KAArB,EAA4B,KAAK,KAAL,CAA5B,CADS;AAET,eAAK,WAAL,CAAiB,IAAjB,EAAuB,KAAvB,EAA8B,KAAK,WAAL,EAAkB,KAAK,eAAL,CAAhD,CAFS;AAGT,cAAI,OAAO,IAAP,CAAY,KAAK,WAAL,CAAZ,CAA8B,MAA9B,KAAyC,CAAzC,EAA4C;AAC9C,iBAAK,IAAL,GAD8C;WAAhD;;;AA/ES,uBAmFX,yBAAO,OAAO;AACZ,eAAK,cAAL,CAAoB,IAApB,EAA0B,KAA1B,EAAiC,KAAK,WAAL,EAAkB,KAAK,eAAL,CAAnD,CADY;AAEZ,eAAK,IAAL,GAFY;;;AAnFH,uBAuFX,uBAAO;AACL,cAAI,CAAJ;cACE,MAAM,KAAK,eAAL,CAAqB,MAArB,CAFH;;AAIL,eAAK,IAAI,CAAJ,EAAO,IAAI,GAAJ,EAAS,EAAE,CAAF,EAAK;AACxB,iBAAK,eAAL,CAAqB,CAArB,IADwB;WAA1B;AAGA,eAAK,eAAL,CAAqB,MAArB,GAA8B,CAA9B,CAPK;AAQL,eAAK,YAAL,CAAkB,IAAlB,EARK;;;eAvFI","file":"flow.js","sourcesContent":["/*eslint no-cond-assign: 0*/\n\nfunction removeListener(element, event, fn) {\n  element.removeEventListener(event, fn, false);\n}\n\nfunction addListener(element, event, fn) {\n  element.addEventListener(event, fn, false);\n  return removeListener.bind(null, element, event, fn);\n}\n\nexport class Flow {\n  constructor(element, Point, events, stopEmulatedMouseEvents) {\n    this.element = element;\n    this.Point = Point;\n    this.events = events;\n    this.stopEmulatedMouseEvents = stopEmulatedMouseEvents;\n    this.addListeners = [];\n    this.removeListeners = [];\n    this.allPointers = {};\n    this.currentPointers = {};\n    this.init();\n  }\n  init() {\n    var event,\n      key,\n      types,\n      type,\n      fn;\n\n    while (event = this.events.shift()) {\n      key = Object.keys(event).shift();\n      types = event[key];\n      fn = this[key].bind(this);\n\n      if (key === \"start\") {\n        this.startListener = addListener.bind(null, this.element, types.shift(), fn);\n      } else {\n        while (type = types.shift()) {\n          this.addListeners.push(addListener.bind(null, this.element, type, fn));\n        }\n      }\n    }\n  }\n  normalizePoints(/*event, data, Point*/) {\n    throw new Error(\"normalizePoints: must be implemented in sub class\");\n  }\n  onStart(startCallback) {\n    this.startCallback = startCallback;\n    return this;\n  }\n  onUpdate(updateCallback) {\n    this.updateCallback = updateCallback;\n    return this;\n  }\n  onCancel(cancelCallback) {\n    this.cancelCallback = cancelCallback;\n    return this;\n  }\n  onEnd(endCallback) {\n    this.endCallback = endCallback;\n    return this;\n  }\n  onStop(stopCallback) {\n    this.stopCallback = stopCallback;\n  }\n  activate() {\n    return this.startListener();\n  }\n  start(event) {\n    this.normalizePoints(event, this.Point);\n    if (this.startCallback(this, event, this.allPointers, this.currentPointers)) {\n      this.continue();\n    }\n  }\n  continue() {\n    var i,\n      cnt = this.addListeners.length;\n\n    for (i = 0; i < cnt; ++i) {\n      this.removeListeners.push(this.addListeners[i]());\n    }\n  }\n  update(event) {\n    this.normalizePoints(event, this.Point);\n    this.updateCallback(this, event, this.allPointers, this.currentPointers);\n  }\n  end(event) {\n    this.normalizePoints(event, this.Point);\n    this.endCallback(this, event, this.allPointers, this.currentPointers);\n    if (Object.keys(this.allPointers).length === 0) {\n      this.stop();\n    }\n  }\n  cancel(event) {\n    this.cancelCallback(this, event, this.allPointers, this.currentPointers);\n    this.stop();\n  }\n  stop() {\n    var i,\n      cnt = this.removeListeners.length;\n\n    for (i = 0; i < cnt; ++i) {\n      this.removeListeners[i]();\n    }\n    this.removeListeners.length = 0;\n    this.stopCallback(this);\n  }\n}\n"]}